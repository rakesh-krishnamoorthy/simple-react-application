name: react-application-workflow 
on:
    workflow_dispatch:
    push:
        branches:
               - "main"

jobs: 
    deploy:
        name: deploying to ec2 
        runs-on: ubuntu-server

        steps:
            - name: Checkout the repository
              uses: actions/checkout@v4

            - name: Deploy the application
              env:
                  PRIVATE_KEY: ${{ secrets.EC2_SSH_PRIV_KEY }}
                  HOST_NAME: ${{ vars.HOST_DNS }}
                  USER_NAME: ${{ vars.USER_NAME }}

              run: |
                  echo "$PRIVATE_KEY" > private_key && chmod 400 private_key
                  ssh -o StrictHostKeyChecking=no -i private_key ${USER_NAME}@${HOST_NAME} '
                      cd ./simple-react-application || exit 1
                      git checkout main || exit 1
                      git pull origin main
                      sh deploy.sh
                      '

                

            
            
